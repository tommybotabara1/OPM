{% extends "home/adminHeaderFooter.html" %}
{% load staticfiles%}

{% block content %}
        <div class="col s12 white"><div class="col s12 m12 l12 center white">
            <div class="section"></div>

            <h3 id="greeting"><i class="material-icons" style="font-size: 40px;">smartphone</i>&nbsp;&nbsp; Change User of Device</h3>
            <div class="section"></div>
            <div class="divider"></div>
            <div class="section"></div>

        </div>

            <div class="col s12 m12 l12  white" style="padding: 0px 20px 0px 30px">
            <div class="row">

                <div class="col green lighten-5">
                <button id='addNewDevice' class='btn btn-small waves-effect'>Add New Device</button>
                </div>
            </div>
            </div>

        <div class="col s12 m12 l12  white" style="padding: 0px 20px 0px 30px">
            <div class="row">

                <div id="devices" class="col s3 green lighten-5">

                    <h6 class="center green lighten-4">Devices</h6>
                    {% if device_list.count == 0 %}
                        <b>No devices</b>
                    {% else %}
                        {% for device in device_list %}
                        <b>Device {{ device.deviceid }}</b>
                        <ol>
                            {% for patient in patient_device_list %}
                                {% if patient.device_deviceid.deviceid == device.deviceid and patient.inuse == 1 %}
                                    <li>{{ patient.patient_patientid.userid.auth_user_id.first_name }} {{ patient.patient_patientid.userid.auth_user_id.last_name }}</li>
                                {% endif %}
                            {% endfor %}
                        </ol>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class = "col s1 center"></div>
                <div class = "col s4 center">
                    <h5 class="">Enter Device ID</h5>
                    <form method="post">
                        <div class="input-field center">
                        <input id="device_ID" type="text" class="validate">
                        <label for="device_ID">Device ID</label>
                        </div>
                        <div class='row center'>
                            <button id='deviceID' class='btn btn-small waves-effect'>Load</button>
                        </div>
                    </form>
                </div>

                <div class="col s4 center">
                    <h5 class="green lighten-5">Patient/s using the Device 1</h5>
                    <div style="height: 130px;border:1px solid #ccc; overflow:auto;">
                        <p>
                          <label>
                            <input type="radio" class="filled-in" checked="checked" />
                            <span>Tommy Botabara</span>
                          </label>
                        </p><p>
                          <label>
                            <input type="checkbox" class="filled-in" checked="checked" />
                            <span>Tommy Botabara</span>
                          </label>
                        </p><p>
                          <label>
                            <input type="checkbox" class="filled-in" checked="checked" />
                            <span>Tommy Botabara</span>
                          </label>
                        </p><p>
                          <label>
                            <input type="checkbox" class="filled-in" checked="checked" />
                            <span>Tommy Botabara</span>
                          </label>
                        </p><p>
                          <label>
                            <input type="checkbox" class="filled-in" checked="checked" />
                            <span>Tommy Botabara</span>
                          </label>
                        </p><p>
                          <label>
                            <input type="checkbox" class="filled-in" checked="checked" />
                            <span>Tommy Botabara</span>
                          </label>
                        </p>
                    </div>
                <div class='input-field col m12 s7'>
                    <i class="material-icons iconis prefix">person_add</i>
                    <input class='validate' type='text' name='text' id='text' />
              </div>
            </div>
        </div>
        <section></section>
        <section></section>
            </div></div>

    <script>
    $("#addNewDevice").click(function () {

      $.ajax({
        url: '{% url 'add_device' %}',
        data: {
        },
        dataType: 'json',
        success: function (data) {
            var devices = " <h6 class=\"center green lighten-4\">Devices</h6>\n";

            console.log(data)
            for(var i = 0; i < data.length; i++){
                if(i == 0){
                    devices += "<b>Device " + data[i].deviceid + "</b>\n";
                    devices += "<ol>\n";

                    if(data[i].patient != "none"){
                        devices += "<li>" + data[i].patient + "</li>\n";
                    }
                }
                else if(data[i - 1].deviceid == data[i].deviceid){
                    devices += "<li>" + data[i].patient + "</li>\n";
                }
                else if(data[i - 1].deviceid != data[i].deviceid){
                    devices += "</ol>\n";
                    devices += "<b>Device " + data[i].deviceid + "</b>\n";
                    devices += "<ol>\n";

                    if(data[i].patient != "none"){
                        devices += "<li>" + data[i].patient + "</li>\n";
                    }

                }
            }
            console.log(devices);
            $("#devices").html(devices);

        }
      });
    });
    </script>
{% endblock %}